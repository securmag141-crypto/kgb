<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω –æ—Ö—Ä–∞–Ω—ã</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        #auth { margin-bottom: 30px; }
        .hidden { display: none; }
        .tab { padding: 10px; cursor: pointer; background: #ddd; }
        .active { background: #bbb; }
        #app { border: 1px solid #ccc; padding: 20px; }
    </style>
</head>
<body>
    <h1>üóìÔ∏è –ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω –æ—Ö—Ä–∞–Ω—ã</h1>

    <div id="auth">
        <h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="signIn()">–í–æ–π—Ç–∏</button>
        <button onclick="signUp()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        <p id="auth-message"></p>
    </div>

    <div id="app" class="hidden">
        <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <span id="user-email"></span> (<span id="user-role"></span>)</p>
        <button onclick="signOut()">–í—ã–π—Ç–∏</button>

        <div style="margin-top: 20px;">
            <div class="tab active" onclick="showTab('calendar')">–ú–æ–∏ —Å–º–µ–Ω—ã</div>
            <div class="tab" onclick="showTab('schedule')">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
            <div class="tab" onclick="showTab('payouts')">–í—ã–ø–ª–∞—Ç—ã</div>
            <div class="tab" onclick="showTab('admin')" id="admin-tab" style="display:none;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–°—Ç–∞—Ä—à–∏–π)</div>
        </div>

        <div id="tab-content">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
            <div id="calendar-tab">
                <h3>–ú–æ–∏ —Å–º–µ–Ω—ã</h3>
                <ul id="my-shifts"></ul>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase (–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—É—á–∏—à—å –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ)
        const supabaseUrl = 'https://your-project-id.supabase.co';
        const supabaseAnonKey = 'your-anon-key';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                showApp(session.user);
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
        }

        async function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { error } = await supabase.auth.signUp({ email, password });
            if (error) alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
            else alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å –ø–æ—á—Ç—É.');
        }

        async function signOut() {
            await supabase.auth.signOut();
            location.reload();
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function showApp(user) {
            document.getElementById('auth').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('user-email').textContent = user.email;
            // –ó–¥–µ—Å—å –º—ã –ø–æ–∑–∂–µ —É–∑–Ω–∞–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserProfile(user.id);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–æ–ª—å)
        async function loadUserProfile(userId) {
            const { data, error } = await supabase
                .from('profiles')
                .select('role')
                .eq('id', userId)
                .single();

            if (data) {
                document.getElementById('user-role').textContent = data.role === 'senior' ? '–°—Ç–∞—Ä—à–∏–π —Å–º–µ–Ω—ã' : '–û—Ö—Ä–∞–Ω–Ω–∏–∫';
                if (data.role === 'senior') {
                    document.getElementById('admin-tab').style.display = 'inline-block';
                }
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
                loadMyShifts();
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–º–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadMyShifts() {
            const { data, error } = await supabase
                .from('shifts')
                .select('*')
                .order('date', { ascending: true });

            const list = document.getElementById('my-shifts');
            list.innerHTML = '';
            if (data) {
                data.forEach(shift => {
                    const li = document.createElement('li');
                    li.textContent = `${shift.date} —Å ${shift.start_time} –¥–æ ${shift.end_time}`;
                    list.appendChild(li);
                });
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            alert('–í–∫–ª–∞–¥–∫–∞ "' + tabName + '" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!');
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        supabase.auth.onAuthStateChange((event, session) => {
            if (session) showApp(session.user);
        });
    </script>
</body>
</html>